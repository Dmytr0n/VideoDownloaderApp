name: Build C# GUI App

on:
  push:
    branches:
      - '*'
    tags:
      - 'v*'
  pull_request:
    branches:
      - '*'

jobs:
  run-script:
      runs-on: windows-latest
      steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up MSBuild
        uses: microsoft/setup-msbuild@v1
     
      - name: Run CMD script
        shell: cmd
        run: |
          .\run.bat 

      - name: Upload script results as artifact
        uses: actions/upload-artifact@v3
        with:
          name: build-project
          path: ./artefacts

      - name: Create GitHub release
        run: |
          RELEASE_NAME="Release $GITHUB_REF_NAME"
          RELEASE_BODY="Automated release for version $GITHUB_REF_NAME"
          RESPONSE=$(curl -s -X POST https://api.github.com/repos/${{ github.repository }}/releases \
            -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
            -d @- <<EOF
            {
              "tag_name": "$GITHUB_REF_NAME",
              "name": "$RELEASE_NAME",
              "body": "$RELEASE_BODY",
              "draft": false,
              "prerelease": false
            }
            EOF
          )
          echo "Release created with tag: $GITHUB_REF_NAME"

